<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport"
      content="width=device-width, initial-scale=1, viewport-fit=cover, user-scalable=no" />
<title>The Desire Wheel üî• ‚Äî Random Photo Picker</title>
<style>
  /* =========================
     THEME ‚Äî HOT LOVE ARCADE
     ========================= */
  :root{
    --bg:#14060a;
    --panel:#1f0a10;
    --panel-2:#260d14;
    --accent:#ff3b6a;          /* hot rose */
    --accent-2:#ff77a1;        /* candy rose */
    --glow:#ff5a84;
    --text:#fff6f8;
    --muted:#ffdce6;
    --line:rgba(255,255,255,.14);
    --shadow:rgba(0,0,0,.5);
    --win: #ffd166;
  }

  /* Typographic stack: playful but native-first (better on iPhone) */
  html,body{height:100%}
  *{box-sizing:border-box; -webkit-tap-highlight-color:transparent}
  body{
    margin:0;
    color:var(--text);
    font-family: ui-rounded, "SF Pro Rounded", "SF Pro Display", "Avenir Next Rounded",
                 "Nunito", "Avenir Next", -apple-system, BlinkMacSystemFont,
                 "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
    min-height:100dvh;
    background:
      radial-gradient(1400px 900px at 50% -10%, #3a1120 0%, transparent 60%),
      linear-gradient(180deg, #0e0407 0%, var(--bg) 100%);
    padding: max(16px, env(safe-area-inset-top))
             max(16px, env(safe-area-inset-right))
             max(16px, env(safe-area-inset-bottom))
             max(16px, env(safe-area-inset-left));
    display:grid; place-items:center; gap:0;
  }

  .shell{
    width:min(1100px, 100%);
    background:linear-gradient(180deg, var(--panel), var(--panel-2));
    border-radius:24px; overflow:hidden; position:relative;
    box-shadow: 0 24px 64px var(--shadow), 0 0 0 1px rgba(255,255,255,.06) inset;
  }

  /* Ambient glow + heart rays */
  .ambient{
    pointer-events:none; position:absolute; inset:0; z-index:0;
    background:
      radial-gradient(900px 380px at 50% 120%, rgba(255,59,106,.18), transparent 60%),
      radial-gradient(700px 400px at 0% 0%, rgba(255,119,161,.12), transparent 65%),
      radial-gradient(700px 400px at 100% 0%, rgba(255,119,161,.12), transparent 65%);
    mask: radial-gradient(150% 100% at 50% 30%, #000 60%, transparent 100%);
  }

  header{
    position:relative; z-index:2;
    padding:14px 16px;
    border-bottom:1px solid var(--line);
    background:linear-gradient(180deg, rgba(255,59,106,.18), rgba(255,59,106,.08), transparent);
    display:flex; align-items:center; justify-content:space-between; gap:10px;
  }
  .brand{
    display:flex; align-items:center; gap:10px; font-weight:900; letter-spacing:.3px;
    text-shadow:0 2px 12px rgba(255,59,106,.25);
    font-size:18px;
  }
  .brand .heart-logo{
    width:28px; height:28px; display:grid; place-items:center; border-radius:10px;
    background:radial-gradient(90% 90% at 50% 30%, #ff9db9 0%, #ff5f8e 40%, #c30037 100%);
    box-shadow:0 8px 18px rgba(255,59,106,.45);
  }
  .meta{color:var(--muted); font-size:12px}

  /* Layout: mobile-first single column, grows to 2 columns */
  .grid{
    position:relative; z-index:2;
    display:grid; grid-template-columns:1fr; min-height:72vh;
  }
  @media (min-width: 900px){
    .grid{ grid-template-columns: 360px 1fr; }
  }

  /* LEFT ‚Äî Controls */
  .panel{
    padding:16px; border-right:1px solid var(--line);
    display:grid; gap:12px; align-content:start;
  }
  @media (max-width: 899px){
    .panel{ border-right:none; border-bottom:1px solid var(--line); }
  }
  .card{
    background:#19070d; border:1px solid var(--line); border-radius:16px; padding:14px;
    box-shadow:0 8px 16px rgba(0,0,0,.25) inset, 0 1px 0 rgba(255,255,255,.04);
  }
  .card h3{
    margin:0 0 10px; font-size:14px; color:var(--muted); font-weight:800; letter-spacing:.2px;
  }
  .drop{
    border:2px dashed rgba(255,119,161,.55); border-radius:14px; padding:14px; text-align:center; cursor:pointer;
    background:rgba(255,59,106,.09); transition: transform .15s ease, background .2s ease, box-shadow .2s ease;
  }
  .drop:hover{ background:rgba(255,59,106,.16); transform: translateY(-1px); box-shadow:0 8px 22px rgba(255,59,106,.25) }
  .drop strong{font-weight:900}
  .drop small{display:block; color:var(--muted)}
  input[type="file"]{display:none}
  textarea{
    width:100%; min-height:80px; resize:vertical;
    background:#14040a; color:var(--text); border:1px solid var(--line); border-radius:12px; padding:10px 12px; font-size:14px;
  }
  .row{display:flex; gap:10px; flex-wrap:wrap}
  .btn{
    appearance:none; border:1px solid rgba(255,255,255,.18);
    background:#15040a; color:var(--text);
    padding:12px 14px; border-radius:14px; cursor:pointer; font-weight:900; font-size:14px;
    transition: transform .07s ease, box-shadow .15s ease, background .12s ease, filter .12s ease;
  }
  .btn:active{ transform: translateY(1px) }
  .btn.primary{
    border-color: transparent; background: linear-gradient(180deg, var(--accent), #ea0b4b);
    color:#33000c; box-shadow: 0 10px 28px rgba(255,59,106,.45);
  }
  .btn.ghost{ background: transparent }
  .btn:disabled{ opacity:.6; cursor: not-allowed; }

  .switch{ display:flex; align-items:center; gap:10px; font-size:13px; color:var(--muted) }
  .switch input{ accent-color: var(--accent); width:18px; height:18px }
  .stat{ font-size:12px; color:var(--muted); margin-top:6px }

  /* RIGHT ‚Äî Game Stage */
  .stage{
    position:relative; display:grid; grid-template-rows: 1fr auto; min-height:50vh; overflow:hidden;
    background:linear-gradient(180deg, #12050a, #19070d);
  }

  /* Lovers silhouette (abstract & tasteful) */
  .silhouette{
    position:absolute; inset:-10% -10% 0 -10%; opacity:.14; pointer-events:none;
    background-repeat:no-repeat; background-position:center 78%; background-size: 80% auto;
    filter: blur(.3px);
    background-image: url('data:image/svg+xml;utf8,\
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 900 700">\
        <defs>\
          <linearGradient id="g" x1="0" y1="0" x2="0" y2="1">\
            <stop offset="0" stop-color="%23ff9db9"/><stop offset="1" stop-color="%23ff3b6a"/>\
          </linearGradient>\
        </defs>\
        <g fill="url(%23g)">\
          <path d="M410,175a85,85,0,1,1,170,0a85,85,0,1,1,-170,0Z"/>\
          <path d="M330,340c30-70,95-110,170-110s140,40,170,110c22,50-5,105-55,130l-70,35a180,180,0,0,1-90,20a180,180,0,0,1-90-20l-70-35c-50-25-77-80-65-130Z" />\
          <path d="M355,355c25-20,55-30,95-30s70,10,95,30c35,30,55,85,35,125l-15,30a30,30,0,0,1-40,13l-75-36l-75,36a30,30,0,0,1-40-13l-15-30c-20-40,0-95,35-125Z"/>\
        </g>\
      </svg>');
  }

  .viewer{
    position:relative; display:grid; place-items:center; padding:14px;
  }
  .photo{
    max-width: 92%; max-height: 66vh; object-fit: contain; border-radius:18px;
    transform-style: preserve-3d; transform: perspective(1000px) translateZ(0);
    box-shadow: 0 16px 40px rgba(0,0,0,.45), 0 0 0 1px rgba(255,255,255,.06) inset;
    display:none;
  }
  .placeholder{
    color:var(--muted); font-size:14px; opacity:.95; text-align:center;
  }
  .badge{
    position:absolute; top:12px; right:12px; background:rgba(30,0,10,.55);
    border:1px solid var(--line); color:var(--text);
    padding:6px 10px; border-radius:999px; font-size:12px; backdrop-filter: blur(6px);
    display:none;
  }

  /* Game HUD */
  .hud{
    position:absolute; left:12px; top:12px; display:flex; gap:8px; flex-wrap:wrap;
    z-index:3;
  }
  .chip{
    font-size:12px; font-weight:900; padding:6px 10px; border-radius:999px; border:1px solid var(--line);
    background: rgba(255,255,255,.06); color:var(--text);
    backdrop-filter: blur(6px);
  }
  .chip.win{ background: linear-gradient(180deg, var(--win), #f7a21a); color:#3a1900; border:none }

  /* Spin Button ‚Äî big arcade button with heartbeat */
  .slot{
    display:grid; place-items:center; padding:12px; border-top:1px solid var(--line);
    background: radial-gradient(100% 100% at 50% 0%, rgba(255,59,106,.12), transparent 70%);
  }
  .spin{
    appearance:none; border:none; cursor:pointer; user-select:none;
    font-weight: 1000; letter-spacing:.3px; font-size:19px;
    color:#33000c; padding:14px 22px; border-radius:999px;
    background: radial-gradient(120% 140% at 50% 20%, #ff9db9 0%, var(--accent) 45%, #c7003a 100%);
    box-shadow: 0 14px 40px rgba(255,59,106,.55), 0 3px 0 rgba(0,0,0,.25) inset;
    transform: translateZ(0);
    transition: transform .06s ease, filter .12s ease;
  }
  .spin:active{ transform: translateY(1px) scale(.98) }
  .spin::after{ content:" ‚ù§Ô∏è SPIN "; }
  .spin.heartbeat{
    animation: beat 1.4s ease-in-out infinite;
  }
  @keyframes beat{
    0%, 100% { transform: scale(1); filter:none }
    15% { transform: scale(1.06) }
    30% { transform: scale(1) }
    45% { transform: scale(1.06) }
    60% { transform: scale(1) }
  }

  /* Reel-style reveal animation */
  .reveal{
    animation: reveal 560ms cubic-bezier(.2,.8,.1,1);
    transform-origin: 50% 60%;
  }
  @keyframes reveal{
    0%   { transform: perspective(900px) rotateX(12deg) scale(.92); filter: blur(8px) brightness(0.8); opacity:0 }
    60%  { transform: perspective(900px) rotateX(-6deg) scale(1.02); filter: blur(2px) brightness(1.05); opacity:1 }
    100% { transform: perspective(900px) rotateX(0deg)  scale(1.0); filter:none; opacity:1 }
  }

  /* Floating hearts confetti */
  .fx{ position:absolute; inset:0; pointer-events:none; overflow:hidden; z-index:4 }
  .heart{ position:absolute; width:16px; height:16px; opacity:0; animation: float 7s linear infinite }
  @keyframes float{
    0%{ opacity:0; transform: translateY(12px) scale(.6) rotate(0deg) }
    10%{ opacity:.9 }
    60%{ opacity:.9 }
    100%{ opacity:0; transform: translateY(-120vh) scale(1.2) rotate(18deg) }
  }
  .thumbs{
    display:grid; grid-auto-flow:column; grid-auto-columns:92px; gap:8px; overflow-x:auto; padding:10px;
    border-top:1px solid var(--line); background:linear-gradient(180deg,#15060c,#12040a);
  }
  .thumbs img{
    width:100%; height:64px; object-fit:cover; border-radius:12px;
    border:1px solid var(--line); cursor:pointer; transition: transform .14s ease, box-shadow .14s ease;
  }
  .thumbs img:hover{ transform: translateY(-2px); box-shadow: 0 10px 20px rgba(0,0,0,.35) }

  /* Mobile tweaks */
  @media (max-width: 420px){
    .brand{ font-size:16px }
    .spin{ font-size:18px; padding:14px 20px }
    .photo{ max-height: 58vh }
  }

  /* ============== INTRO OVERLAY ============== */
  .intro{
    position: fixed; inset: 0; z-index: 100;
    display: grid; place-items: center; text-align: center;
    padding: 40px 20px;
    background:
      radial-gradient(1200px 800px at 50% -20%, rgba(255,59,106,.14), transparent 60%),
      linear-gradient(180deg, rgba(10,0,4,.98), rgba(20,0,10,.96));
  }
  .intro-card{
    width:min(720px, 94vw);
    background: linear-gradient(180deg, #1d0710, #2a0a14);
    border:1px solid var(--line);
    border-radius: 22px;
    padding: 24px 18px;
    box-shadow: 0 18px 48px rgba(0,0,0,.55), 0 0 0 1px rgba(255,255,255,.06) inset;
  }
  .intro h1{
    margin:0 0 10px;
    font-size: 26px; letter-spacing: .2px; font-weight: 1000;
    text-shadow: 0 2px 10px rgba(255,59,106,.25);
  }
  .intro p{
    margin: 10px auto; color: var(--muted); font-size: 15px; line-height: 1.7;
    max-width: 560px;
  }
  .intro .tag{
    display:inline-block; margin-bottom: 8px;
    color:#33000c; background: radial-gradient(100% 140% at 50% 20%, #ff9db9 0%, var(--accent) 60%, #c7003a 100%);
    padding:6px 10px; border-radius: 999px; font-weight: 900; font-size: 12px;
    box-shadow: 0 10px 24px rgba(255,59,106,.45);
  }
  .intro .cta{
    margin-top: 14px; display:flex; gap:10px; justify-content:center; flex-wrap:wrap;
  }
  .intro .btn{ font-size: 15px; padding: 12px 16px; border-radius: 16px }
  .intro .skip{
    background: transparent; border: 1px solid var(--line); color: var(--muted);
  }
  .fade-out{ animation: fadeout .35s ease forwards }
  @keyframes fadeout{ to{ opacity:0; visibility:hidden } }
</style>
</head>
<body>
  <div class="shell" role="application" aria-label="The Desire Wheel">
    <div class="ambient"></div>

    <header>
      <div class="brand">
        <span class="heart-logo">üíñ</span>
        <span>The Desire Wheel üî•</span>
      </div>
      <div class="meta"><span id="count">0</span> photos ‚Ä¢ no-repeat mode</div>
    </header>

    <!-- INTRO OVERLAY -->
    <div class="intro" id="intro">
      <div class="intro-card">
        <div class="tag">A romantic chance game</div>
        <h1>‚ú® The Story Begins...</h1>
        <p>
          Once upon a night wrapped in passion and chance, two hearts stood before
          <strong>The Desire Wheel</strong>. Each spin could uncover a spark, a memory,
          or a secret waiting to be revealed.
        </p>
        <p>
          Fate whispers, desire burns, and every photo hides a story.
          Dare to spin, and let love decide your destiny. ‚ù§Ô∏è‚Äçüî•
        </p>
        <div class="cta">
          <button class="btn primary" id="startBtn">Begin the Game</button>
          <button class="btn skip" id="skipBtn">Skip</button>
          <label class="switch" style="align-items:center">
            <input type="checkbox" id="rememberIntro" />
            <span style="color:var(--muted); font-size:12px">Don't show again</span>
          </label>
        </div>
      </div>
    </div>

    <div class="grid">
      <!-- LEFT: Controls -->
      <aside class="panel">
        <section class="card">
          <h3>1) Add photos</h3>
          <label class="drop" id="dropzone">
            <strong>Tap to choose files</strong> or drag & drop
            <small>JPG ‚Ä¢ PNG ‚Ä¢ GIF ‚Ä¢ WebP ‚Äî multiple allowed</small>
            <input type="file" id="fileInput" accept="image/*" multiple />
          </label>
          <div class="stat" id="fileStats"></div>
        </section>

        <section class="card">
          <h3>2) Or paste URLs (one per line)</h3>
          <textarea id="urlBox" placeholder="https://example.com/photo1.jpg
https://example.com/photo2.png"></textarea>
          <div class="row" style="margin-top:8px">
            <button class="btn" id="addUrlsBtn">Add URLs</button>
            <button class="btn ghost" id="clearBtn">Clear</button>
          </div>
        </section>

        <section class="card">
          <h3>3) Game settings</h3>
          <label class="switch"><input type="checkbox" id="noRepeat" checked /> No repeats until all shown</label>
          <label class="switch"><input type="checkbox" id="avoidImmediate" checked /> Avoid immediate repeat</label>
          <div class="stat" id="cycleStats"></div>
        </section>
      </aside>

      <!-- RIGHT: Stage -->
      <section class="stage" id="stage">
        <div class="silhouette" aria-hidden="true"></div>
        <div class="fx" id="fx" aria-hidden="true"></div>

        <!-- HUD -->
        <div class="hud">
          <div class="chip">Round: <span id="round">0</span></div>
          <div class="chip">Shown: <span id="shown">0</span></div>
          <div class="chip win" id="streakChip" style="display:none">Hot Streak! üî•<span id="streak">0</span></div>
        </div>

        <div class="viewer" id="viewer">
          <div class="placeholder" id="ph">Load some photos, then hit <b>SPIN</b> üíì</div>
          <img id="display" class="photo" alt="" />
          <div class="badge" id="badge"></div>
        </div>

        <div class="slot">
          <button class="spin heartbeat" id="spinBtn" disabled></button>
        </div>

        <div class="thumbs" id="thumbs" aria-label="History thumbnails"></div>
      </section>
    </div>
  </div>

<script>
/* =========================
   INTRO LOGIC
   ========================= */
const intro = document.getElementById('intro');
const startBtn = document.getElementById('startBtn');
const skipBtn = document.getElementById('skipBtn');
const rememberIntro = document.getElementById('rememberIntro');

// Restore preference
try {
  const hideIntro = localStorage.getItem('desirewheel_hide_intro') === '1';
  if (hideIntro) intro.style.display = 'none';
} catch (_) {}

// Actions
function hideIntroOverlay(){
  intro.classList.add('fade-out');
  setTimeout(()=>{ intro.style.display='none'; }, 360);
  try { if (rememberIntro.checked) localStorage.setItem('desirewheel_hide_intro','1'); } catch(_){}
}
startBtn.addEventListener('click', hideIntroOverlay);
skipBtn.addEventListener('click', hideIntroOverlay);

/* =========================
   GAME LOGIC
   ========================= */
const $ = s => document.querySelector(s);
const $$ = s => document.querySelectorAll(s);

const files = [];        // {src, name, type, from:'file'|'url'}
let pool = [];           // current cycle indices
let lastIndex = null;
const history = [];      // last ~50 picks
let round = 0;
let streak = 0;

// Elements
const countEl = $('#count');
const fileStats = $('#fileStats');
const cycleStats = $('#cycleStats');
const noRepeat = $('#noRepeat');
const avoidImmediate = $('#avoidImmediate');
const urlBox = $('#urlBox');
const addUrlsBtn = $('#addUrlsBtn');
const clearBtn = $('#clearBtn');
const fileInput = $('#fileInput');
const dropzone = $('#dropzone');
const display = $('#display');
const badge = $('#badge');
const ph = $('#ph');
const thumbs = $('#thumbs');
const spinBtn = $('#spinBtn');
const stage = $('#stage');
const fxLayer = $('#fx');
const roundEl = $('#round');
const shownEl = $('#shown');
const streakChip = $('#streakChip');
const streakEl = $('#streak');

// Utility
const haptics = ms => { if (navigator.vibrate) navigator.vibrate(ms); };
function shuffle(arr){ for(let i=arr.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [arr[i],arr[j]]=[arr[j],arr[i]]; } }
function updateCounts(){
  countEl.textContent = files.length;
  spinBtn.disabled = files.length === 0;
  if (noRepeat.checked){
    cycleStats.textContent = pool.length
      ? `${pool.length} remaining this round`
      : files.length ? `Round complete ‚Äî tap SPIN to start again` : '';
  } else {
    cycleStats.textContent = 'Pure random (repeats allowed)';
  }
  fileStats.textContent = files.length ? `${files.length} in list` : '';
  shownEl.textContent = history.length;
}
function resetCycle(){
  pool = Array.from(files.keys());
  shuffle(pool);
  updateCounts();
}
function renderThumbs(){
  thumbs.innerHTML = '';
  for (let k=history.length-1; k>=0; k--){
    const i = history[k];
    const img = document.createElement('img');
    img.src = files[i].src;
    img.title = files[i].name || '';
    img.addEventListener('click', ()=> showIndex(i, false));
    thumbs.appendChild(img);
  }
}
function showIndex(i, animate=true){
  const item = files[i]; if(!item) return;
  ph.style.display = 'none';
  display.src = item.src;
  display.alt = item.name || 'image';
  display.style.display = '';
  badge.style.display = '';
  badge.textContent = item.name || (item.from==='url' ? 'URL image' : 'Image');

  if (animate){
    display.classList.remove('reveal');
    void display.offsetWidth; // restart animation
    display.classList.add('reveal');
  }
  lastIndex = i;
}

function pick(){
  if (!files.length) return;
  round++;
  roundEl.textContent = round;

  let i;
  if (noRepeat.checked){
    if (pool.length === 0) resetCycle();
    i = pool.pop();
    if (avoidImmediate.checked && files.length>1 && i===lastIndex){
      if (pool.length){ const j=pool.pop(); pool.unshift(i); i=j; }
    }
  } else {
    do { i = Math.floor(Math.random()*files.length); }
    while (avoidImmediate.checked && files.length>1 && i===lastIndex);
  }

  // update history + streak
  if (history.length && history[history.length-1] !== i) streak++; else streak = 1;
  history.push(i); if (history.length > 50) history.shift();
  renderThumbs();
  shownEl.textContent = history.length;

  showIndex(i, true);
  updateCounts();
  celebrate();
}

// FX: floating hearts + burst
function spawnHeart(burst=false){
  const span = document.createElement('span');
  span.className = 'heart';
  const size = 12 + Math.random()*20;
  const left = burst ? (40 + Math.random()*20) : (Math.random()*100);
  const delay = Math.random()*4;
  span.style.width = size+'px';
  span.style.height = size+'px';
  span.style.left = left+'%';
  span.style.bottom = burst ? '0px' : '-18px';
  span.style.animationDelay = delay+'s';
  const hue = 350 + Math.random()*20;
  const light = 65 + Math.random()*12;
  span.innerHTML = `<svg viewBox="0 0 24 22" xmlns="http://www.w3.org/2000/svg"><path fill="hsl(${hue} 100% ${light}% / 1)" d="M12 21s-1-.55-2.6-1.67C5.1 16.7 1 13.8 1 9.5 1 6.46 3.46 4 6.5 4 8.24 4 9.82 4.8 11 6.06 12.18 4.8 13.76 4 15.5 4 18.54 4 21 6.46 21 9.5c0 4.3-4.1 7.2-8.4 9.83C13 20.45 12 21 12 21z"/></svg>`;
  fxLayer.appendChild(span);
  setTimeout(()=>span.remove(), 8000);
}
setInterval(()=>{ if (document.hasFocus()) spawnHeart(false); }, 1000);

function celebrate(){
  try{
    haptics([18, 60, 18]);
    const actx = new (window.AudioContext||window.webkitAudioContext)();
    const o = actx.createOscillator();
    const g = actx.createGain();
    o.type='triangle'; o.frequency.value=660; g.gain.value=0.001;
    o.connect(g); g.connect(actx.destination);
    o.start();
    const now = actx.currentTime;
    g.gain.exponentialRampToValueAtTime(0.02, now+0.02);
    o.frequency.exponentialRampToValueAtTime(180, now+0.18);
    g.gain.exponentialRampToValueAtTime(0.00001, now+0.25);
    o.stop(now+0.26);
    setTimeout(()=>actx.close(), 350);
  }catch(_){}

  for(let k=0;k<10;k++) setTimeout(()=>spawnHeart(true), k*60);

  if (streak >= 3){
    streakChip.style.display = '';
    streakEl.textContent = ' x' + streak;
  } else {
    streakChip.style.display = 'none';
  }

  spinBtn.classList.remove('heartbeat');
  void spinBtn.offsetWidth;
  spinBtn.classList.add('heartbeat');
}

// Handlers: files and URLs
function handleFiles(list){
  const accepted = Array.from(list).filter(f => f.type.startsWith('image/'));
  for (const f of accepted){
    const url = URL.createObjectURL(f);
    files.push({ src: url, name: f.name, type: f.type, from: 'file' });
  }
  if (noRepeat.checked) resetCycle(); else updateCounts();
}
function addUrlList(text){
  const lines = text.split(/\r?\n/).map(s=>s.trim()).filter(Boolean);
  let added = 0;
  for (const url of lines){
    if (!/^https?:\/\/.+/i.test(url)) continue;
    const name = url.split('/').pop().split('?')[0];
    files.push({ src: url, name, type: 'url', from: 'url' }); added++;
  }
  if (added){ if (noRepeat.checked) resetCycle(); else updateCounts(); }
  return added;
}

// Inputs
fileInput.addEventListener('change', e=>handleFiles(e.target.files));
dropzone.addEventListener('click', ()=>fileInput.click());
dropzone.addEventListener('dragover', e=>{ e.preventDefault(); dropzone.style.background='rgba(255,59,106,.18)'; });
dropzone.addEventListener('dragleave', ()=> dropzone.style.background='rgba(255,59,106,.09)');
dropzone.addEventListener('drop', e=>{
  e.preventDefault(); dropzone.style.background='rgba(255,59,106,.09)';
  handleFiles(e.dataTransfer.files);
});

addUrlsBtn.addEventListener('click', ()=>{
  const n = addUrlList(urlBox.value);
  urlBox.value = '';
  if (!n) alert('No valid URLs detected. Put one image URL per line.');
});
clearBtn.addEventListener('click', ()=>{
  if (!files.length) return;
  if (!confirm('Clear all loaded photos?')) return;
  files.forEach(f=>{ if (f.from==='file') URL.revokeObjectURL(f.src); });
  files.length=0; history.length=0; lastIndex=null; pool.length=0; round=0; streak=0;
  ph.style.display = '';
  display.style.display='none'; badge.style.display='none';
  thumbs.innerHTML = ''; updateCounts();
  roundEl.textContent = '0';
  shownEl.textContent = '0';
  streakChip.style.display='none';
});

// Spin button + gestures
function pickProxy(){ if (!spinBtn.disabled) pick(); }
spinBtn.addEventListener('click', pickProxy);
stage.addEventListener('click', (e)=>{
  if (e.target.closest('.thumbs') || e.target.closest('.panel')) return;
  pickProxy();
});

window.addEventListener('keydown', e=>{
  if (e.code === 'Space'){ e.preventDefault(); pickProxy(); }
});

// Init
updateCounts();
</script>
</body>
</html>
